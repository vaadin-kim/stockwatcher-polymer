<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="yahoo-finance-quote">
    <template>
        <iron-ajax
                id="query"
                url="https://jsonp.afeld.me/"
                handle-as="json"
                on-response="_handleResponse"
                debounce-duration="300"
                loading="{{loading}}"
                verbose></iron-ajax>
    </template>
    <script>
        Polymer({
            is: 'yahoo-finance-quote',

            properties: {
                loading: {
                    type: Boolean,
                    notify: true,
                    value: false
                }
            },

            _handleResponse: function (event) {
                if (event.type != "error") {
                    event.stopPropagation();
                    this.fire('response', event.detail.response);
                }
            },

            requestQuotes: function (symbols) {
                var xhr = this.$.query;
                if (xhr != undefined && symbols.length > 0) {
                    var url = "http://finance.yahoo.com/webservice/v1/symbols/" + symbols.join(",") + "/quote?format=json&view=detail";
                    xhr.params = {
                        url: url
                    };
                    xhr.generateRequest();
                }
            }
            /* select * from yahoo.finance.quote where symbol in ("YHOO","AAPL","GOOG","MSFT") */
        })
    </script>
</dom-module>

